<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p><a href="https://www.inflearn.com/course/%EC%8A%A4%EC%9C%84%ED%94%84%ED%8A%B8-%EB%AC%B8%EB%B2%95-%EB%A7%88%EC%8A%A4%ED%84%B0-%EC%8A%A4%EC%BF%A8">앨런 Swift문법 마스터 스쿨 (온라인 BootCamp - 2개월과정)</a></p>

<h1 id="ios에서의-네트워크-통신">iOS에서의 네트워크 통신</h1>

<pre><code class="language-Swift">let movieURL = "https://kobis.or.kr/kobisopenapi/webservice/rest/boxoffice/searchDailyBoxOfficeList.json"
let structURL = URL(string: movieURL)!
URLSession.shared.dataTask(with: structURL) { data, response, error in
	if error != nil { // 에러 체크
		print(error?.localizedDescription)
		return
	}
	guard let safeData = data else {
		return
	}
	dump(parseJSON(safeData))
}.resume()
</code></pre>

<h2 id="ios의-네트워킹">iOS의 네트워킹</h2>

<h3 id="1-ios-데이터-요청의-4단계">1) iOS 데이터 요청의 4단계</h3>
<p>웹 브라우저로 하는 통신에 대입해봅시다.</p>
<ol>
  <li>URL 구조체</li>
  <li>URLSession
    <ul>
      <li>웹 브라우저 실행</li>
    </ul>
  </li>
  <li>dataTask
    <ul>
      <li>url 입력</li>
    </ul>
  </li>
  <li>시작 (resume)
    <ul>
      <li>Enter</li>
    </ul>
  </li>
</ol>

<h3 id="2-data--json-타입의-응답">2) Data / JSON 타입의 응답</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
	</span><span class="p">{</span><span class="w">
		</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">22</span><span class="w">
	</span><span class="p">},</span><span class="w">
	</span><span class="p">{</span><span class="w">
		</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Mary"</span><span class="p">,</span><span class="w">
		</span><span class="nl">"age"</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="w">
	</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<h3 id="3-실제-사용-타입으로-변환">3) 실제 사용 타입으로 변환</h3>
<p><code class="language-plaintext highlighter-rouge">Data</code>나 <code class="language-plaintext highlighter-rouge">json</code> 타입의 데이터를 그대로 사용할 수는 없으니 Swift에서 평소에 사용하던 <code class="language-plaintext highlighter-rouge">struct</code>나 <code class="language-plaintext highlighter-rouge">class</code> 타입으로 변환하는 과정이 필요합니다.</p>

<p>이 과정을 JSON Parsing이라고 부르고, Swift는 이 파싱을 위한 <code class="language-plaintext highlighter-rouge">Codable</code> 프로토콜을 지원합니다.</p>

<pre><code class="language-Swift">struct MovieData: Codable {
	let boxOfficeResult: BoxOfficeResult
}

struct BoxOfficeResult: Codable {
	let dailyBoxOfficeList: [DailyBoxOfficeList]
}

struct DailyBoxOfficeList: Codable {
	let rank: String
	let movieNm: String
	let audiCnt: String
	let audiAcc: String
	let openDt: String
}
</code></pre>

<pre><code class="language-Swift">func pareJSON(_ movieData: Data) -&gt; [DailyBoxOfficeList]? {
	do {
		let decoder = JSONDecoder()
		let decodedData = try decoder.decode(MovieData.self, from: movieData)
		return decodedData.boxOfficeResult.dailyBoxOfficeList
	} catch {
		return nil
	}
}
</code></pre>

<p>여기서 핵심은</p>

<p><code class="language-plaintext highlighter-rouge">try decoder.decode(MovieData.self, from: movieData)</code></p>

<p>이 부분입니다.</p>

<p>만들어둔 <code class="language-plaintext highlighter-rouge">MovieData</code>라는 구조체의 형식에 맞게 <code class="language-plaintext highlighter-rouge">movieData</code>를 <code class="language-plaintext highlighter-rouge">JSONDecoder</code>를 사용해서 변환하겠다는 의미입니다.</p>

<p><code class="language-plaintext highlighter-rouge">Codable</code>을 붙여둔 구조체의 형식이 데이터와 맞다면, 자동으로 <code class="language-plaintext highlighter-rouge">json</code> 데이터를 변환하여 함수의 리턴 타입인 <code class="language-plaintext highlighter-rouge">[DailyBoxOfficeList]?</code>의 형태로 받아올 수 있습니다.</p>

<h4 id="codable">Codable</h4>

<p><code class="language-plaintext highlighter-rouge">Codable</code>은 <code class="language-plaintext highlighter-rouge">Encodable</code>과 <code class="language-plaintext highlighter-rouge">Decodable</code>을 통합한 프로토콜입니다.</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Encodable</code>: 데이터 ➡️ 클래스, 구조체</li>
  <li>
<code class="language-plaintext highlighter-rouge">Decodable</code>: 클래스, 구조체 ➡️ 데이터</li>
</ul>
</body></html>
